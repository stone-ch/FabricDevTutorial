## 记录开发过程中遇到的各种错误和解决办法
1.  创建通道的时候遇到的错误：
    ```
    Error: got unexpected status: FORBIDDEN -- Failed to reach implicit threshold of 1 sub-policies, required 1 remaining: permission denied
    ```
    Peer加入通道时遇到的错误，此时Peer可以安装链码，但是不能实例化：
    ```
    2018-10-09 10:20:14.228 CST [blocksProvider] DeliverBlocks -> ERRO 386 [fabricchannel] Got error &{FORBIDDEN}

    2018-10-09 10:53:06.071 CST [common/deliver] deliverBlocks -> WARN 013 [channel: fabricchannel] Client authorization revoked for deliver request from 127.0.0.1:48986: Failed to reach implicit threshold of 1 sub-policies, required 1 remaining: permission denied
    ```

    我的解决办法：

    按照以上思路解决再三检查配置文件之后，仍未解决，最终将crypto-config.yaml中的PeerOrgs->EnableNodeOUs设为true，然后问题解决。目前还不能非常肯定问题的原因，但是感觉还是和账户管理相关。

    其他可能的解决思路：
    - 检查配置文件中各种MSPID的对应是否一致，比如core.yaml中的“localMspId”和orderer.yaml中的“LocalMSPID”必须和configtx.yaml中的ID一致。
    - 检查各种证书路径是否正确。如果设置了环境变量也要检查。
    - 检查configtx.yaml中“Organizations”下组织的权限规则设置是否有问题。
    - 每次修改完成配置文件之后，删除core.yaml，orderer.yaml，configtx.yaml，crypto-config.yaml以外的所有文件，以防残余文件产生冲突。

2. 启动orderer start的时候报错：
    ```
    panic: Error creating channelconfig bundle: initializing configtx manager failed: bad channel ID: channel ID 'Ordererchannel' contains illegal characters
    ```
    创建orderer创世块的时候，-channelID 后边接的通道名不能包含大写。该处通道名，不能和peer channel create 创建的通道名一样，不然也会出现 1 中的错误 ```got unexpected status: FORBIDDEN```。
    ```
    $ configtxgen -profile OrdererChannel -outputBlock genesisblock -channelID ordererchannel
    ```

3. 多Peer节点操作链码时报错“chaincode fingerprint mismatch: data mismatch”
    ```
    Error: endorsement failure during query. response: status:500 message:"failed to execute transaction bed01c78367286e45aafef9e85764993b5315a63f686974c7c70055512365118: [channel atlchannel] failed to get chaincode container info for cc:1.0: could not get chaincode code: chaincode fingerprint mismatch: data mismatch"
    ```
    解决方案，先打包链码再在各个peer安装链码安装包：
    ```
    $ peer chaincode package -n cc -p github.com/hyperledger/fabric/examples/chaincode/go/example02/cmd -v 1.02 ccpack.out  // 打包链码安装包

    $ peer chaincode install ccpack.out // 安装链码。注意：这里不需要-n -v -p 的参数，生成package的时候已经指定这些参数了。

    $ peer chaincode update -o 148.70.109.243:7050 -C atlchannel -n cc -v 1.02 -c '{"Args":["init","a","100","b","200"]}'   // （可选）升级链码
    ```

4. 执行"peer chaincode query"无反应。
    问题背景：搭建两个Peer节点，第一个Peer安装完Chaincode测试没有问题，第二个Peer安装完Chaincode之后，执行"peer chaincode query" 等了很久没有反应。

    解决方案：什么也没做，去吃了个饭，回来居然没问题了，可以查询出结果。据说使用SDK查询的时候，如果没有同步完成会有返回信息，但是CLI没有。

    问题反思：query查询的是本地的内容，应该和网络没什么关系，一致查不出结果，很可能是peer的账本文件没有同步完成导致的。以后再遇到此类问题应该注意的地方：
    - configtx.yaml->Organizations->SampleOrg->AnchorPeers 这个值应该要设置，Anchor Peer是和其他组织节点通信的节点，可能对同步账本有影响。
    - core.yaml->peer->gossip->bootstrap 这里配置gossip初始的连接地址，合理的配置可能会影响账本同步的速度。
    - core.yaml->peer->gossip->externalEndpoint 设置这里的ip可以让外部组织的peer找到该peer。不太确定具体作用，但是可能会影响到该peer被其他peer发现。  

5. 裸机部署多节点（即不使用Docker)，本想通过7051和8051部署两个Peer，但是 ```peer node start``` 的时候端口冲突报错。
    ```
    Error: failed to initialize operations subystems: listen tcp 127.0.0.1:9443: bind: address already in use
    ```

    看来单机多节点部署，只能使用docker了。

6. 添加 TLS 报错：
    ```
    remote error: tls: bad certificate
    ```

    应该是证书问题，目前还未解决。

7. 节点使用Couchdb报错：
    ```
    [200~Error calling CouchDB CreateDatabaseIfNotExist(for system dbName: _users, error: error decoding response body: json: cannot unmarshal string into Go struct field DBInfo.purge_seq of type int)]
    ```
    peer没有权限创建Couchdb已存在的表。
    解决方案：将Couchdb 2.3 版本切换到2.1.1后解决。
    切换方法，基于Docker：
    ```
    $ docker pull couchdb:2.1.1
    $ docker run -p 5984:5984 -d couchdb:2.1.1
    ``` 
    然后打开网址 http://127.0.0.1:5984/_utils/ 设置管理员用户名密码即可。

